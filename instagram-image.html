<link rel="import" href="../polymer/polymer-element.html">

<dom-module id="instagram-image">
  <template>
    <style>
    :host() {
      --gallery-icon-opacity: 1;
      --left-arrow-opacity: 0;
      --right-arrow-opacity: 0;
    }
    :host([hidden]) {
      display: none;
    }
    .instagram-image {
      width: 100%;
      height: 100%;
      position: relative;
    }
    .instagram-image img {
      width:100%;
    }
    .transition {
      transition-property: opacity;
      transition-duration: 0.3s;
      transition-timing-function: ease-out;
      transition-delay: .1s;
    }
    .instagram-gallery-icon {
      position: absolute;
      right: 3px;
      top: -1px;
      height: 47px;
      width: 47px;
      background-image: url(fb48443ec9d3.png);
      background-position: -238px -251px;
      opacity: var(--gallery-icon-opacity);
    }
    .instagram-image-indicator {
      position: absolute;
      bottom: 15px;
      left: 6px;
      right: 6px;
      -webkit-box-align: center;
      -webkit-align-items: center;
      -ms-flex-align: center;
      text-align: center;
    }
    .instagram-image-circle {
      display: inline-block;
      border-radius: 50%;
      height: 6px;
      margin-left: 2px;
      margin-right: 2px;
      -webkit-transition: all .2s ease-in-out;
      transition: all .2s ease-in-out;
      width: 6px;
      background: #fff;
    }
    .changeImageButton {
      height: 30px;
      width: 30px;
      cursor: pointer;
      display: block;
      margin-left: 12px;
      margin-right: 12px;
      overflow: hidden;
      position: absolute;
      pointer-events: auto;
      text-indent: -9999em;
      top: 50%;
    }
    .chevronLeft {
      left: 0;
      background-image: url(9e7638226e17.png);
      background-size: 429px 398px;
      background-position: -210px -134px;
      opacity: var(--left-arrow-opacity);

    }
    .chevronRight {
      right: 0;
      background-image: url(9e7638226e17.png);
      background-size: 429px 398px;
      background-position: -113px -310px;
      opacity: var(--right-arrow-opacity);

    }
    </style>
    <div class="instagram-image" on-mouseover="_imageHover" on-mouseout="_imageUnhover">
      <a href$=[[_instagramUrl]] hidden$=[[_isvideo]]>
        <img id="instagramImage" class="instagram-image" >
      </a>
      <template is="dom-if" if=[[!singleImage]] restamp="true">
        <div class="instagram-gallery-icon transition" on-click="_clickVideo" on-mouseover="_imageHover" on-mouseout="_imageUnhover"></div>
        <div class="changeImageButton transition chevronRight">
        </div>
        <div class="changeImageButton transition chevronLeft">
        </div>
        <div class="instagram-image-indicator">
          <template is="dom-repeat" items="[[image]]">
            <div class="instagram-image-circle" style$="[[_computeIndexOpacity(index)]]"></div>
          </template>
        </div>
      </template>

    </div>
  </template>
  <script>
  /**
  * `instagram-post-image`
  * Display an Instagram post in your Polymer website
  *
  * @customElement
  * @polymer
  */
  class InstagramPostImage extends Polymer.Element {
    static get is() { return 'instagram-image'; }
    static get properties() {
      return {
        currentImage: {
          type: Number,
          value: 0
        },
        image: {
          type: String,
          observer: '_observerImage'
        },
        singleImage: {
          type: Boolean,
          value: true
        }
      };
    }
    _loadImage(image) {
      this.$.instagramImage.src = image;
    }
    _imageHover() {
      this.updateStyles({'--gallery-icon-opacity': 0});
      if (this.currentImage != 0)
        this.updateStyles({'--left-arrow-opacity': 0.75});
      if (this.currentImage != this.image.length-1)
        this.updateStyles({'--right-arrow-opacity': 0.75});
    }
    _imageUnhover() {
      this.updateStyles({'--gallery-icon-opacity': 1});
      this.updateStyles({'--left-arrow-opacity': 0});
      this.updateStyles({'--right-arrow-opacity': 0});
    }
    _observerImage(image) {
      this._loadImage(image[0]);
      let imageCount = image.length;
      if (imageCount > 1) {
        this.set('singleImage', false);
      }
    }
    _computeIndexOpacity(index) {
      if (index == this.currentImage) return "opacity: 1";
      else return "opacity: 0.4";
    }
    connectedCallback() {
      super.connectedCallback();
      this.updateStyles({'--left-arrow-opacity': 0});
      this.updateStyles({'--right-arrow-opacity': 0});
    }
  }

  window.customElements.define(InstagramPostImage.is, InstagramPostImage);
  </script>
</dom-module>
